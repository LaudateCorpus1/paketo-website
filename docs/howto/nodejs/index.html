<!doctype html>
<html>

<head>
    <meta charset="utf-8">

<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PN39N8V');</script>

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Node.js Buildpack - Paketo Buildpacks</title>
<meta name="viewport" content="width=device-width, initial-scale=1">




<meta name="og:site_name" content="Paketo Buildpacks">
<meta name="og:title" content="Node.js Buildpack">
<meta name="og:url" content="https://paketo.io/docs/howto/nodejs/">
<meta name="twitter:title" content="Paketo Buildpacks" />
<meta name="twitter:url" content="https://paketo.io/docs/howto/nodejs/" />
<meta name="twitter:card" content="" />
<link rel="stylesheet" href="/css/main-v1.min.7a9a3fb621d1aafddddeee0bff82cae4463214bd78ad0dd0fe0ef5781ee7a41e.css">
</head>

<body>
    
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PN39N8V"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    

    <div id="header-skip-link" class="screenreader-container">
    <a href="#title" class="screenreader-text">Skip to Content</a>
</div>

    



<header class="header ">
    <a class="paketo-logo" href="/">
        <img class="paketo-logo__image" src="/v2/images/logo-paketo-light.svg" alt="Paketo Buildpacks Homepage">
    </a>
    <div id="navigation" class="right-overlay">
        <div class="nav-opener">
            <span class="nav-opener__bar nav-opener__bar-top"></span>
            <span class="nav-opener__bar nav-opener__bar-middle"></span>
            <span class="nav-opener__bar nav-opener__bar-bottom"></span>
        </div>
        <div class="nav-container" id="nav-container">
            <nav class="nav" id="nav-tray" >
                <div class="nav__linkarea">
                    <a class="nav-link " href="/docs">docs</a>
                    <a class="nav-link " href="/community">community</a>
                    <a class="nav-link " href="https://blog.paketo.io">blog</a>
                    <a class="nav-link " href="https://github.com/paketo-buildpacks">github</a>
                </div>
            </nav>
        </div>
    </div>
    <div class="desktop-nav">
        
        
        
        <a class="nav-link nav-link--active" href="/docs">docs</a>
        
        <a class="nav-link " href="/community">community</a>
        <a class="nav-link " href="https://blog.paketo.io">blog</a>
        <a class="nav-link " href="https://github.com/paketo-buildpacks">github</a>
    </div>
</header>


    <div class="docs">
    <div class="docs-sidebar">
        
<nav class="docs-menu">
    <h4 class="docs-menu__title">PAKETO DOCS</h4>
    <ul class="docs-menu__top-level-list">
        
        
            
    
        <li class="docs-menu__leaf">
            <a href="/docs/" class="docs-menu__link ">
                
                <span>Getting Started</span>
            </a>
        </li>
    
        
            
    
        <li class="docs-menu__parent">
            
            <div class="docs-menu__section-header">
                
                <span>How To</span>
            </div>
            
            <ul class="docs-menu__children-list">
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/howto/dotnet-core/" class="docs-menu__link ">
                
                <span>.NET Core</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/howto/go/" class="docs-menu__link ">
                
                <span>Go</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/howto/web-servers/" class="docs-menu__link ">
                
                <span>Web Servers</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/howto/java-native-image/" class="docs-menu__link ">
                
                <span>Java Native Image</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/howto/java/" class="docs-menu__link ">
                
                <span>Java</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/howto/nodejs/" class="docs-menu__link docs-menu__link--active">
                
                <span>Node.js</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/howto/php/" class="docs-menu__link ">
                
                <span>PHP</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/howto/ruby/" class="docs-menu__link ">
                
                <span>Ruby</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/howto/create-paketo-buildpack/" class="docs-menu__link ">
                
                <span>Create a Paketo Buildpack</span>
            </a>
        </li>
    
                
            </ul>
        </li>
    
        
            
    
        <li class="docs-menu__parent">
            
            <div class="docs-menu__section-header">
                
                <span>Concepts</span>
            </div>
            
            <ul class="docs-menu__children-list">
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/concepts/buildpacks/" class="docs-menu__link ">
                
                <span>Buildpacks</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/concepts/builders/" class="docs-menu__link ">
                
                <span>Builders</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/concepts/stacks/" class="docs-menu__link ">
                
                <span>Stacks</span>
            </a>
        </li>
    
                
            </ul>
        </li>
    
        
            
    
        <li class="docs-menu__parent">
            
            <div class="docs-menu__section-header">
                
                <span>Reference</span>
            </div>
            
            <ul class="docs-menu__children-list">
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/reference/configuration/" class="docs-menu__link ">
                
                <span>Configuring Paketo Buildpacks</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/reference/go-reference/" class="docs-menu__link ">
                
                <span>Go Buildpack</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/reference/httpd-reference/" class="docs-menu__link ">
                
                <span>HTTPD Buildpack</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/reference/dotnet-core-reference/" class="docs-menu__link ">
                
                <span>.NET Core Buildpack</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/reference/nginx-reference/" class="docs-menu__link ">
                
                <span>NGINX Buildpack</span>
            </a>
        </li>
    
                
                    
    
        <li class="docs-menu__leaf">
            <a href="/docs/reference/ruby-reference/" class="docs-menu__link ">
                
                <span>Ruby Buildpack</span>
            </a>
        </li>
    
                
            </ul>
        </li>
    
        
    </ul>
</nav>



    </div>
    <div class="docs-body">
        <div class="docs-body__container">
            





  <a href="http://github.com/paketo-buildpacks/paketo-website/edit/main/content/docs/howto/nodejs.md" target="_blank" class="github-edit" style="text-decoration:none">
    <div class="github-edit__content">
      <div class="github-edit__logo-container">
        <img class="github-edit__logo" src="/images/github-mark.png">
      </div>
        <div class="github-edit__text">Edit</div>
    </div>
</a>

            <h1 id="title">Node.js Buildpack</h1>
            
<div class="docs-body__table-of-contents-container docs-body__table-of-contents-container--mobile">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#supported-dependencies">Supported Dependencies</a></li>
    <li><a href="#specifying-a-node-engine-version">Specifying a Node Engine Version</a>
      <ul>
        <li><a href="#using-bp_node_version">Using BP_NODE_VERSION</a></li>
        <li><a href="#using-packagejson">Using package.json</a></li>
        <li><a href="#using-nvmrc">Using .nvmrc</a></li>
        <li><a href="#using-node-version">Using .node-version</a></li>
        <li><a href="#deprecated-using-buildpackyml">Deprecated: Using buildpack.yml</a></li>
      </ul>
    </li>
    <li><a href="#buildpack-set-environment-variables">Buildpack-Set Environment Variables</a>
      <ul>
        <li><a href="#memory_available">MEMORY_AVAILABLE</a></li>
        <li><a href="#node_env">NODE_ENV</a></li>
        <li><a href="#node_home">NODE_HOME</a></li>
        <li><a href="#node_verbose">NODE_VERBOSE</a></li>
        <li><a href="#npm_config_loglevel">NPM_CONFIG_LOGLEVEL</a></li>
        <li><a href="#npm_config_production">NPM_CONFIG_PRODUCTION</a></li>
        <li><a href="#path">PATH</a></li>
      </ul>
    </li>
    <li><a href="#enabling-heap-memory-optimization">Enabling Heap Memory Optimization</a>
      <ul>
        <li><a href="#using-bp_node_optimize_memory-environment-variable">Using <code>BP_NODE_OPTIMIZE_MEMORY</code> Environment Variable</a></li>
        <li><a href="#deprecated-using-buildpackyml-1">Deprecated: Using buildpack.yml</a></li>
      </ul>
    </li>
    <li><a href="#node-start-command">Node Start Command</a>
      <ul>
        <li><a href="#using-bp_launchpoint">Using BP_LAUNCHPOINT</a></li>
      </ul>
    </li>
    <li><a href="#specifying-project-directory">Specifying Project Directory</a></li>
    <li><a href="#package-management-with-npm">Package Management with NPM</a>
      <ul>
        <li><a href="#npm-installation-process">NPM Installation Process</a></li>
        <li><a href="#determining-node-modules-layer-reuse">Determining Node Modules Layer Reuse</a></li>
        <li><a href="#npm-configuration">NPM Configuration</a></li>
        <li><a href="#npm-start-command">NPM Start Command</a></li>
      </ul>
    </li>
    <li><a href="#package-management-with-yarn">Package Management with Yarn</a>
      <ul>
        <li><a href="#yarn-installation-process">Yarn Installation Process</a></li>
        <li><a href="#yarn-configuration">Yarn Configuration</a></li>
        <li><a href="#yarn-start-command">Yarn Start Command</a></li>
      </ul>
    </li>
    <li><a href="#projects-without-package-management">Projects Without Package Management</a>
      <ul>
        <li><a href="#start-command">Start Command</a></li>
      </ul>
    </li>
    <li><a href="#using-ca-certificates">Using CA Certificates</a></li>
    <li><a href="#setting-custom-start-processes">Setting Custom Start Processes</a></li>
    <li><a href="#setting-environment-variables-in-the-app-image">Setting Environment Variables in the App Image</a></li>
    <li><a href="#adding-custom-labels-to-the-app-image">Adding Custom Labels to the App Image</a></li>
    <li><a href="#stack-support">Stack support</a></li>
  </ul>
</nav>
</div>

            <div class="docs-body__markdown">
                <p>The <a href="https://github.com/paketo-buildpacks/nodejs">Node.js Paketo Buildpack</a> supports several popular configurations for Node.js apps.</p>
<p>To build a sample app locally with this CNB using the <code>pack</code> CLI, run</p>
<pre class="copyable"><code class="copyable__code">git clone https://github.com/paketo-buildpacks/samples
cd samples/nodejs/npm
pack build my-app --buildpack gcr.io/paketo-buildpacks/nodejs \
  --builder paketobuildpacks/builder:base
</code><img class="copyable__clipboard" src="/images/clipboard.svg" alt="copy to clipboard" /><div class="copyable__copied copied">Copied!</div></pre>

<p>See <a href="https://github.com/paketo-buildpacks/samples/tree/main/nodejs/npm">samples</a>
for how to run the app.</p>
<p><strong>NOTE: Though the example above uses the Paketo Base builder, this buildpack is
also compatible with the Paketo Full builder. The Paketo Full builder is
required if your app utilizes common C libraries.</strong></p>
<h2 id=" supported-dependencies " class="markup-heading">
    <a class="markup-heading__link" href="#supported-dependencies">
        Supported Dependencies
    </a>
</h2><p>The Node.js Paketo Buildpack supports several versions of Node.js.
For more details on the specific versions supported in a given buildpack
version, see the <a href="https://github.com/paketo-buildpacks/nodejs/releases">release
notes</a>.</p>
<h2 id=" specifying-a-node-engine-version " class="markup-heading">
    <a class="markup-heading__link" href="#specifying-a-node-engine-version">
        Specifying a Node Engine Version
    </a>
</h2><p>The Node Engine CNB (Cloud Native Buildpack) allows you to specify a version of Node.js to use during
deployment. This version can be specified in a number of ways, including
through the <code>BP_NODE_VERSION</code> environment variable, a <code>package.json</code>, <code>.nvmrc</code> or <code>.node-version</code> files. When specifying a
version of the Node.js engine, you must choose a version that is available
within the buildpack. The supported versions can be found <a href="https://github.com/paketo-buildpacks/node-engine/releases/latest">here</a>.</p>
<p>The buildpack prioritizes the versions specified in
each possible configuration location with the following precedence, from
highest to lowest: <code>BP_NODE_VERSION</code>, <code>package.json</code>, <code>.nvmrc</code> and <code>.node-version</code>.</p>
<h3 id=" using-bp_node_version " class="markup-heading">
    <a class="markup-heading__link" href="#using-bp_node_version">
        Using BP_NODE_VERSION
    </a>
</h3><p>To configure the buildpack to use Node.js v12.12.0 when deploying your app, set the
following environment variable at build time, either directly (ex. <code>pack build my-app --env BP_NODE_VERSION=12.12.0</code>) or through a
<a href="https://github.com/buildpacks/spec/blob/main/extensions/project-descriptor.md">project.toml</a>
file:</p>
<pre class="copyable"><code class="copyable__code">BP_NODE_VERSION=&#34;12.12.0&#34;
</code><img class="copyable__clipboard" src="/images/clipboard.svg" alt="copy to clipboard" /><div class="copyable__copied copied">Copied!</div></pre>

<h3 id=" using-packagejson " class="markup-heading">
    <a class="markup-heading__link" href="#using-packagejson">
        Using package.json
    </a>
</h3><p>If your apps use <code>npm</code> or <code>yarn</code>, you can specify the Node.js version your apps use
during deployment by configuring the <code>engines</code> field in the <code>package.json</code>
file. To configure the buildpack to use Node.js v12.12.0 when deploying your
app, include the values below in your <code>package.json</code> file:</p>
<pre class="copyable"><code class="copyable__code">{
  &#34;engines&#34;: {
    &#34;node&#34;: &#34;12.12.0&#34;
  }
}
</code><img class="copyable__clipboard" src="/images/clipboard.svg" alt="copy to clipboard" /><div class="copyable__copied copied">Copied!</div></pre>

<p>For more information about the <code>engines</code> configuration option in the
<code>package.json</code> file, see the
<a href="https://docs.npmjs.com/files/package.json#engines">engines</a> section of the
<em>npm-package.json</em> topic in the NPM documentation.</p>
<h3 id=" using-nvmrc " class="markup-heading">
    <a class="markup-heading__link" href="#using-nvmrc">
        Using .nvmrc
    </a>
</h3><p>Node Version Manager is a common option for managing the Node.js version an app
uses. To specify the Node.js version your apps use during deployment, include a
<code>.nvmrc</code> file with the version number. For more information about the contents
of a <code>.nvmrc</code> file, see <a href="https://github.com/nvm-sh/nvm#nvmrc">.nvmrc</a> in the
Node Version Manager repository on GitHub.</p>
<h3 id=" using-node-version " class="markup-heading">
    <a class="markup-heading__link" href="#using-node-version">
        Using .node-version
    </a>
</h3><p><code>.node-version</code> is another common option that is compatible with Node.js version managers
such as <code>asdf</code> and <code>nodenv</code>. You can use a <code>.node-version</code> file to set the Node.js version
that your apps use during deployment, according to one of the following formats:</p>
<pre class="copyable"><code class="copyable__code">12.12.0
</code><img class="copyable__clipboard" src="/images/clipboard.svg" alt="copy to clipboard" /><div class="copyable__copied copied">Copied!</div></pre>

<p>OR</p>
<pre class="copyable"><code class="copyable__code">v12.12.0
</code><img class="copyable__clipboard" src="/images/clipboard.svg" alt="copy to clipboard" /><div class="copyable__copied copied">Copied!</div></pre>

<p>OR</p>
<pre class="copyable"><code class="copyable__code">12.12
</code><img class="copyable__clipboard" src="/images/clipboard.svg" alt="copy to clipboard" /><div class="copyable__copied copied">Copied!</div></pre>

<h3 id=" deprecated-using-buildpackyml " class="markup-heading">
    <a class="markup-heading__link" href="#deprecated-using-buildpackyml">
        Deprecated: Using buildpack.yml
    </a>
</h3><p>Specifying the Node version through <code>buildpack.yml</code> configuration will be deprecated in Node Engine Buildpack v1.0.0.
To migrate from using <code>buildpack.yml</code> please set the <code>$BP_NODE_VERSION</code> environment variable.</p>
<h2 id=" buildpack-set-environment-variables " class="markup-heading">
    <a class="markup-heading__link" href="#buildpack-set-environment-variables">
        Buildpack-Set Environment Variables
    </a>
</h2><p>The Node.js CNB sets a number of environment variables during the <code>build</code> and
<code>launch</code> phases of the app lifecycle. The sections below describe each
environment variable and its impact on your app.</p>
<h3 id=" memory_available " class="markup-heading">
    <a class="markup-heading__link" href="#memory_available">
        MEMORY_AVAILABLE
    </a>
</h3><p>The <code>MEMORY_AVAILABLE</code> environment variable reports the total amount of memory
available to the app. The Node.js CNB calculates this value from the limits
specified by the operating system in
<code>/sys/fs/cgroup/memory/memory.limit_in_bytes</code>.</p>
<ul>
<li>Set by: <code>profile.d</code></li>
<li>Phases: <code>launch</code></li>
<li>Value: non-negative integer</li>
</ul>
<h3 id=" node_env " class="markup-heading">
    <a class="markup-heading__link" href="#node_env">
        NODE_ENV
    </a>
</h3><p>The <code>NODE_ENV</code> environment variable specifies the environment in which the app
runs.</p>
<ul>
<li>Set by: <code>node-engine</code> buildpack</li>
<li>Phases: <code>build</code></li>
<li>Value: production</li>
</ul>
<h3 id=" node_home " class="markup-heading">
    <a class="markup-heading__link" href="#node_home">
        NODE_HOME
    </a>
</h3><p>The <code>NODE_HOME</code> environment variable sets the path to the <code>node</code> installation.</p>
<ul>
<li>Set by: <code>node-engine</code> buildpack</li>
<li>Phases: <code>build</code></li>
<li>Value: path to the <code>node</code> installation</li>
</ul>
<h3 id=" node_verbose " class="markup-heading">
    <a class="markup-heading__link" href="#node_verbose">
        NODE_VERBOSE
    </a>
</h3><p>The <code>NODE_VERBOSE</code> environment variable adjusts the amount of logging output
from NPM during installs.</p>
<ul>
<li>Set by: <code>node-engine</code> buildpack</li>
<li>Phases: <code>build</code></li>
<li>Value: false</li>
</ul>
<h3 id=" npm_config_loglevel " class="markup-heading">
    <a class="markup-heading__link" href="#npm_config_loglevel">
        NPM_CONFIG_LOGLEVEL
    </a>
</h3><p>The <code>NPM_CONFIG_LOGLEVEL</code> environment variable adjusts the level of logging NPM
uses.</p>
<ul>
<li>Set by: <code>npm-install</code> buildpack</li>
<li>Phases: <code>build</code></li>
<li>Value: &ldquo;error&rdquo;</li>
</ul>
<h3 id=" npm_config_production " class="markup-heading">
    <a class="markup-heading__link" href="#npm_config_production">
        NPM_CONFIG_PRODUCTION
    </a>
</h3><p>The <code>NPM_CONFIG_PRODUCTION</code> environment variable installs only production
dependencies if NPM install is used.</p>
<ul>
<li>Set by: <code>npm-install</code> buildpack</li>
<li>Phases: <code>build</code></li>
<li>Value: false</li>
</ul>
<h3 id=" path " class="markup-heading">
    <a class="markup-heading__link" href="#path">
        PATH
    </a>
</h3><p>The <code>node_modules/.bin</code> directory is appended onto the <code>PATH</code> environment variable</p>
<ul>
<li>Set by: <code>yarn-install</code> or <code>npm-install</code> buildpacks</li>
<li>Phases: <code>build</code></li>
<li>Value: path to the <code>node_modules/.bin</code> directory</li>
</ul>
<h2 id=" enabling-heap-memory-optimization " class="markup-heading">
    <a class="markup-heading__link" href="#enabling-heap-memory-optimization">
        Enabling Heap Memory Optimization
    </a>
</h2><p>Node.js limits the total size of all objects on the heap. Enabling the
<code>optimize-memory</code> feature sets this value to three-quarters of the total memory
available in the container. For example, if your app is limited to 1 GB
when pushed, the heap of your Node.js app is limited to 768 MB.</p>
<p>You can enable memory optimization through the <code>BP_NODE_OPTIMIZE_MEMORY</code> environment variable.</p>
<h3 id=" using-bp_node_optimize_memory-environment-variable " class="markup-heading">
    <a class="markup-heading__link" href="#using-bp_node_optimize_memory-environment-variable">
        Using <code>BP_NODE_OPTIMIZE_MEMORY</code> Environment Variable
    </a>
</h3><p>To enable memory optimization through the <code>BP_NODE_OPTIMIZE_MEMORY</code> environment
variable, set it to <code>true</code>.</p>
<pre class="copyable"><code class="copyable__code">pack build my-app \
  --buildpack gcr.io/paketo-buildpacks/nodejs \
  --env BP_NODE_OPTIMIZE_MEMORY=true
</code><img class="copyable__clipboard" src="/images/clipboard.svg" alt="copy to clipboard" /><div class="copyable__copied copied">Copied!</div></pre>

<h3 id=" deprecated-using-buildpackyml-1 " class="markup-heading">
    <a class="markup-heading__link" href="#deprecated-using-buildpackyml-1">
        Deprecated: Using buildpack.yml
    </a>
</h3><p>Enabling memory optimization through your <code>buildpack.yml</code> file will be
deprecated in Node Engine Buildpack v1.0.0. To migrate from using
<code>buildpack.yml</code> please set the <code>BP_NODE_OPTIMIZE_MEMORY</code> environment variable
mentioned above.</p>
<h2 id=" node-start-command " class="markup-heading">
    <a class="markup-heading__link" href="#node-start-command">
        Node Start Command
    </a>
</h2><p>The Node.js CNB allows you to build a Node.js app that does not rely on any
external packages. To detect whether for not the app is a Node.js app the
Node.js app looks for one of the following files in your apps root directory:</p>
<ul>
<li><code>server.js</code></li>
<li><code>app.js</code></li>
<li><code>main.js</code></li>
<li><code>index.js</code></li>
</ul>
<p>The Node.js CNB will then set the start command to be <code>node &lt;detected file&gt;</code>.
If you have multiples of these files in your apps root directory then the one
will be chosen based on a priority list which reflects the order of the list
above with <code>server.js</code> being the highest priority and  <code>index.js</code> being the
lowest.</p>
<h3 id=" using-bp_launchpoint " class="markup-heading">
    <a class="markup-heading__link" href="#using-bp_launchpoint">
        Using BP_LAUNCHPOINT
    </a>
</h3><p>The <code>BP_LAUNCHPOINT</code> environment variable may be used to specify a file for the
start command that is not included in the set of files the buildpack looks for
by default. The buildpack will verify that the file specified exists and then
use that as to set the start command. <code>BP_LAUNCHPOINT</code> can be used as follows:</p>
<pre class="copyable"><code class="copyable__code">BP_LAUNCHPOINT=./src/launchpoint.js
</code><img class="copyable__clipboard" src="/images/clipboard.svg" alt="copy to clipboard" /><div class="copyable__copied copied">Copied!</div></pre>

<p>This will result in the following start command: <code>node src/launchpoint.js</code></p>
<h2 id=" specifying-project-directory " class="markup-heading">
    <a class="markup-heading__link" href="#specifying-project-directory">
        Specifying Project Directory
    </a>
</h2><p>To specify a subdirectory to be used as the root of the app, please use the
<code>BP_NODE_PROJECT_PATH</code> environment variable at build time either directly or
through a <a href="https://buildpacks.io/docs/app-developer-guide/using-project-descriptor"><code>project.toml</code></a>.
This could be useful if your app is a part of a monorepo.</p>
<p>For example, if your project has the following structure:</p>
<pre><code>.
├── go-app
│   ├── go.mod
│   └── main.go
└── node-app
    ├── file.js
    ├── index.js
    └── package.json
</code></pre><p>you could then set the following at build time.</p>
<pre><code>$BP_NODE_PROJECT_PATH=node-app
</code></pre><h2 id=" package-management-with-npm " class="markup-heading">
    <a class="markup-heading__link" href="#package-management-with-npm">
        Package Management with NPM
    </a>
</h2><p>Many Node.js apps require a number of third-party libraries to perform common
tasks and behaviors. NPM is an option for managing these third-party
dependencies that the Node.js CNB fully supports. Including a <code>package.json</code>
file in your app source code triggers the NPM installation process. The sections
below describe the NPM installation process run by the buildpack.</p>
<h3 id=" npm-installation-process " class="markup-heading">
    <a class="markup-heading__link" href="#npm-installation-process">
        NPM Installation Process
    </a>
</h3><p>NPM supports several distinct methods for installing your package dependencies.
Specifically, the Node.js CNB runs either the <a href="https://docs.npmjs.com/cli-commands/install"><code>npm install</code></a>, <a href="https://docs.npmjs.com/cli-commands/rebuild.html"><code>npm rebuild</code></a>, or <a href="https://docs.npmjs.com/cli-commands/ci.html"><code>npm ci</code></a> commands to build your app
with the right set of dependencies. When deciding which installation process to
use, the Node.js CNB consults your app source code, looking for the presence of
specific files or directories. The installation process used also determines
how the Node.js CNB will reuse layers when rebuilding your app.</p>
<p>The table below shows the process the Node.js CNB uses to determine an
installation process for NPM packages. When a combination of the files and
directories listed in the table below are present in your app source code,
the Node.js CNB uses an installation process that ensures the
correct third-party dependencies are installed during the build process.</p>
<table>
<thead>
<tr>
<th><code>package-lock.json</code></th>
<th><code>node_modules</code></th>
<th><code>npm-cache</code></th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td>X</td>
<td>X</td>
<td>X</td>
<td><code>npm install</code></td>
</tr>
<tr>
<td>X</td>
<td>X</td>
<td>✓</td>
<td><code>npm install</code></td>
</tr>
<tr>
<td>X</td>
<td>✓</td>
<td>X</td>
<td><code>npm rebuild</code></td>
</tr>
<tr>
<td>X</td>
<td>✓</td>
<td>✓</td>
<td><code>npm rebuild</code></td>
</tr>
<tr>
<td>✓</td>
<td>X</td>
<td>X</td>
<td><code>npm ci</code></td>
</tr>
<tr>
<td>✓</td>
<td>X</td>
<td>✓</td>
<td><code>npm ci</code></td>
</tr>
<tr>
<td>✓</td>
<td>✓</td>
<td>X</td>
<td><code>npm rebuild</code></td>
</tr>
<tr>
<td>✓</td>
<td>✓</td>
<td>✓</td>
<td><code>npm ci</code></td>
</tr>
</tbody>
</table>
<p>The following sections give more information about the files listed in the
table above, including how to generate them, if desired.</p>
<h4 id=" package-lockjson " class="markup-heading">
    <a class="markup-heading__link" href="#package-lockjson">
        package-lock.json
    </a>
</h4><p>The <code>package-lock.json</code> file is generated by running <code>npm install</code>.  For
more information, see
<a href="https://docs.npmjs.com/files/package-lock.json">npm-package-lock.json</a> in the
NPM documentation.</p>
<h4 id=" node_modules " class="markup-heading">
    <a class="markup-heading__link" href="#node_modules">
        node_modules
    </a>
</h4><p>The <code>node_modules</code> directory contains vendored copies of all the packages
installed by the <code>npm install</code> process. For more information, see the <a href="https://docs.npmjs.com/files/folders.html#node-modules">Node
Modules</a> section of the
<em>npm-folders</em> topic in the NPM documentation.</p>
<h4 id=" npm-cache " class="markup-heading">
    <a class="markup-heading__link" href="#npm-cache">
        npm-cache
    </a>
</h4><p>The <code>npm-cache</code> directory contains a content-addressable cache that stores all
HTTP-request- and package-related data. Additionally, including a cache ensures
that the app can be built entirely offline.</p>
<p>To populate an <code>npm-cache</code> directory:</p>
<ol>
<li>Navigate to your source code directory.</li>
<li>Run:
<pre class="copyable"><code class="copyable__code">npm ci --cache npm-cache
</code><img class="copyable__clipboard" src="/images/clipboard.svg" alt="copy to clipboard" /><div class="copyable__copied copied">Copied!</div></pre>
</li>
</ol>
<p>For more information about the NPM cache, see
<a href="https://docs.npmjs.com/cli/cache">npm-cache</a> in the NPM documentation.</p>
<h3 id=" determining-node-modules-layer-reuse " class="markup-heading">
    <a class="markup-heading__link" href="#determining-node-modules-layer-reuse">
        Determining Node Modules Layer Reuse
    </a>
</h3><p>To improve build times for apps, the Node.js CNB has a method for reusing the build
results from previous builds. When the CNB determines that a portion of the
build process can be reused from a previous build, the CNB uses the previous
result. Each installation process uses a different method for determining
whether the CNB can reuse a previous build result.</p>
<p>For <code>npm install</code>, the CNB never reuses a <code>node_modules</code> directory from previous builds.</p>
<p>For <code>npm rebuild</code>, the CNB can reuse a <code>node_modules</code> directory from a previous
build if the included <code>node_modules</code> directory in the app source code has not
changed since the prior build.</p>
<p>For <code>npm ci</code>, the CNB can reuse a <code>node_modules</code> directory from a previous
build if the <code>package-lock.json</code> file included in the app source code has not
changed since the prior build.</p>
<h3 id=" npm-configuration " class="markup-heading">
    <a class="markup-heading__link" href="#npm-configuration">
        NPM Configuration
    </a>
</h3><p>The Node.js CNB respects native configuration options for NPM. If you would
like to learn more about NPM native configuration please check the NPM
Configuration <a href="https://docs.npmjs.com/cli/v6/using-npm/config">documentation</a>
and the <code>.npmrc</code>
<a href="https://docs.npmjs.com/cli/v6/configuring-npm/npmrc">documentation</a>.</p>
<h3 id=" npm-start-command " class="markup-heading">
    <a class="markup-heading__link" href="#npm-start-command">
        NPM Start Command
    </a>
</h3><p>As part of the build process, the Node.js CNB determines a start command for
your app. The start command differs depending on which package management
tooling the Node.js CNB uses. If the Node.js CNB uses <code>npm</code> or <code>yarn</code> to
install packages, the start command is generated from the contents of
<code>package.json</code>.</p>
<h2 id=" package-management-with-yarn " class="markup-heading">
    <a class="markup-heading__link" href="#package-management-with-yarn">
        Package Management with Yarn
    </a>
</h2><p>Many Node.js apps require a number of third-party libraries to perform common
tasks and behaviors. Yarn is an alternative option to NPM for managing these
third-party dependencies. Including <code>package.json</code> and <code>yarn.lock</code> files in
your app source code triggers the Yarn installation process.</p>
<h3 id=" yarn-installation-process " class="markup-heading">
    <a class="markup-heading__link" href="#yarn-installation-process">
        Yarn Installation Process
    </a>
</h3><p>The Node.js CNB runs <code>yarn install</code> and <code>yarn check</code> to ensure that third-party
dependencies are properly installed.
The <code>yarn.lock</code> file contains a fully resolved set of package dependencies that
Yarn manages. For more information, see
<a href="https://yarnpkg.com/lang/en/docs/yarn-lock/">yarn.lock</a> in the Yarn
documentation.</p>
<h3 id=" yarn-configuration " class="markup-heading">
    <a class="markup-heading__link" href="#yarn-configuration">
        Yarn Configuration
    </a>
</h3><p>The Node.js CNB respects native configuration options for Yarn. If you would
like to learn more about Yarn configuration using <code>.yarnrc</code> please visit <a href="https://classic.yarnpkg.com/en/docs/yarnrc">the
Yarn documentation</a>.</p>
<h3 id=" yarn-start-command " class="markup-heading">
    <a class="markup-heading__link" href="#yarn-start-command">
        Yarn Start Command
    </a>
</h3><p>As part of the build process, the Node.js CNB determines a start command for
your app. The start command differs depending on which package management
tooling the Node.js CNB uses. If the Node.js CNB uses <code>yarn</code> to install
packages, the start command is <code>yarn start</code>.</p>
<h2 id=" projects-without-package-management " class="markup-heading">
    <a class="markup-heading__link" href="#projects-without-package-management">
        Projects Without Package Management
    </a>
</h2><p>The Node.js CNB also supports simple apps that do not require third-party packages.</p>
<h3 id=" start-command " class="markup-heading">
    <a class="markup-heading__link" href="#start-command">
        Start Command
    </a>
</h3><p>If no package manager is detected, the Node.js CNB will set the start command
<code>node server.js</code>. The app name is <em><strong>not</strong></em> currently configurable.</p>
<h2 id=" using-ca-certificates " class="markup-heading">
    <a class="markup-heading__link" href="#using-ca-certificates">
        Using CA Certificates
    </a>
</h2><p>Node.js Buildpack users can provide their own CA certificates and have them
included in the container root truststore at build-time and runtime by
following the instructions outlined in the <a href="https://paketo.io/docs/buildpacks/configuration/#ca-certificates">CA
Certificates</a>
section of our configuration docs.</p>
<h2 id=" setting-custom-start-processes " class="markup-heading">
    <a class="markup-heading__link" href="#setting-custom-start-processes">
        Setting Custom Start Processes
    </a>
</h2><p>Node.js Buildpack users can set custom start processes for their app image by
following the instructions in the
<a href="https://paketo.io/docs/buildpacks/configuration/#procfiles">Procfiles</a> section
of our configuration docs.</p>
<h2 id=" setting-environment-variables-in-the-app-image " class="markup-heading">
    <a class="markup-heading__link" href="#setting-environment-variables-in-the-app-image">
        Setting Environment Variables in the App Image
    </a>
</h2><p>Node.js Buildpack users can embed launch-time environment variables in their
app image by following the documentation for the <a href="https://github.com/paketo-buildpacks/environment-variables/blob/main/README.md">Environment Variables
Buildpack</a>.</p>
<h2 id=" adding-custom-labels-to-the-app-image " class="markup-heading">
    <a class="markup-heading__link" href="#adding-custom-labels-to-the-app-image">
        Adding Custom Labels to the App Image
    </a>
</h2><p>Node.js Buildpack users can add labels to their app image by following the
instructions in the <a href="https://paketo.io/docs/buildpacks/configuration/#applying-custom-labels">Applying Custom
Labels</a>
section of our configuration docs.</p>
<h2 id=" stack-support " class="markup-heading">
    <a class="markup-heading__link" href="#stack-support">
        Stack support
    </a>
</h2><p>The Node.js Buildpack runs fine on the Base builder for most apps. If your app
requires compilation of native extensions using <code>node-gyp</code>, the buildpack requires that
you use the Full builder. This is because <code>node-gyp</code> requires <code>python</code> which is excluded from the
the Base builder, and the module may require other shared objects.</p>

            </div>
            





  <a href="http://github.com/paketo-buildpacks/paketo-website/edit/main/content/docs/howto/nodejs.md" target="_blank" class="github-edit" style="text-decoration:none">
    <div class="github-edit__content">
      <div class="github-edit__logo-container">
        <img class="github-edit__logo" src="/images/github-mark.png">
      </div>
        <div class="github-edit__text">Edit</div>
    </div>
</a>

            <p class="docs-mod-time"><strong>Last modified:</strong> July 16, 2021</p>
        </div>
        
<div class="docs-body__table-of-contents-container docs-body__table-of-contents-container--desktop">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#supported-dependencies">Supported Dependencies</a></li>
    <li><a href="#specifying-a-node-engine-version">Specifying a Node Engine Version</a>
      <ul>
        <li><a href="#using-bp_node_version">Using BP_NODE_VERSION</a></li>
        <li><a href="#using-packagejson">Using package.json</a></li>
        <li><a href="#using-nvmrc">Using .nvmrc</a></li>
        <li><a href="#using-node-version">Using .node-version</a></li>
        <li><a href="#deprecated-using-buildpackyml">Deprecated: Using buildpack.yml</a></li>
      </ul>
    </li>
    <li><a href="#buildpack-set-environment-variables">Buildpack-Set Environment Variables</a>
      <ul>
        <li><a href="#memory_available">MEMORY_AVAILABLE</a></li>
        <li><a href="#node_env">NODE_ENV</a></li>
        <li><a href="#node_home">NODE_HOME</a></li>
        <li><a href="#node_verbose">NODE_VERBOSE</a></li>
        <li><a href="#npm_config_loglevel">NPM_CONFIG_LOGLEVEL</a></li>
        <li><a href="#npm_config_production">NPM_CONFIG_PRODUCTION</a></li>
        <li><a href="#path">PATH</a></li>
      </ul>
    </li>
    <li><a href="#enabling-heap-memory-optimization">Enabling Heap Memory Optimization</a>
      <ul>
        <li><a href="#using-bp_node_optimize_memory-environment-variable">Using <code>BP_NODE_OPTIMIZE_MEMORY</code> Environment Variable</a></li>
        <li><a href="#deprecated-using-buildpackyml-1">Deprecated: Using buildpack.yml</a></li>
      </ul>
    </li>
    <li><a href="#node-start-command">Node Start Command</a>
      <ul>
        <li><a href="#using-bp_launchpoint">Using BP_LAUNCHPOINT</a></li>
      </ul>
    </li>
    <li><a href="#specifying-project-directory">Specifying Project Directory</a></li>
    <li><a href="#package-management-with-npm">Package Management with NPM</a>
      <ul>
        <li><a href="#npm-installation-process">NPM Installation Process</a></li>
        <li><a href="#determining-node-modules-layer-reuse">Determining Node Modules Layer Reuse</a></li>
        <li><a href="#npm-configuration">NPM Configuration</a></li>
        <li><a href="#npm-start-command">NPM Start Command</a></li>
      </ul>
    </li>
    <li><a href="#package-management-with-yarn">Package Management with Yarn</a>
      <ul>
        <li><a href="#yarn-installation-process">Yarn Installation Process</a></li>
        <li><a href="#yarn-configuration">Yarn Configuration</a></li>
        <li><a href="#yarn-start-command">Yarn Start Command</a></li>
      </ul>
    </li>
    <li><a href="#projects-without-package-management">Projects Without Package Management</a>
      <ul>
        <li><a href="#start-command">Start Command</a></li>
      </ul>
    </li>
    <li><a href="#using-ca-certificates">Using CA Certificates</a></li>
    <li><a href="#setting-custom-start-processes">Setting Custom Start Processes</a></li>
    <li><a href="#setting-environment-variables-in-the-app-image">Setting Environment Variables in the App Image</a></li>
    <li><a href="#adding-custom-labels-to-the-app-image">Adding Custom Labels to the App Image</a></li>
    <li><a href="#stack-support">Stack support</a></li>
  </ul>
</nav>
</div>

    </div>
</div>


    <footer class="footer text--light">
    <div class="footer-social-links-container">
        <a class="footer-social-link" href="https://twitter.com/Paketo_io">
            <div class="footer-social-link__image-container">
                <img class="footer-social-link__image-container__image" src="/v2/images/logo-twitter.svg" alt="Blue Twitter bird logo"/>
            </div>
            <div class="text--light">
                Twitter
            </div>
        </a>
        <a class="footer-social-link" href="https://slack.paketo.io/">
            <div class="footer-social-link__image-container">
                <img class="footer-social-link__image-container__image" src="/v2/images/logo-slack.svg" alt="Slack logo"/>
            </div>
            <div class="text--light">
                Slack
            </div>
        </a>
        <a class="footer-social-link" href="https://github.com/paketo-buildpacks">
            <div class="footer-social-link__image-container">
                <img src="/v2/images/logo-github.svg" alt="GitHub Octocat logo"/>
            </div>
            <div class="text--light">
                GitHub
            </div>
        </a>
    </div>
    <div class="footer-privacy-policy">
        <div class="footer-text--small">Paketo Buildpacks is a <a class="text--light" href="https://www.cloudfoundry.org/">Cloud Foundry</a> Project</div>
        <img class="cloudfoundry-logo" src="/v2/images/logo-cloudfoundry-light.svg" alt="Cloud Foundry logo" />
        <a class="footer-text--small text--light" href="https://www.linuxfoundation.org/privacy">Privacy Policy</a>
    </div>
</footer><script src="/js/main.bdf8c7d2f9a1646cf0a78c52a0a869a3323a3f810afca6042260f94774f4b9fe.js"></script>

    <div id="footer-skip-link" class="screenreader-container">
    <a href="#header-skip-link" class="screenreader-text">Skip to Header</a>
</div>

</body>

</html>
